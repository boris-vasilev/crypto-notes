Lecture

# Key Management Issues (for Symmetric-key ciphers)
- Generation issues
- Storage issues
- Distribution issues
- Establishment issues
- Revocation and replacement issues
# Symmetric key (Shared secret) Establishment
## Diffie-Hellman (DH) protocol
### Key Hierarchy
- Master key/secret (key encryption key)
	- used to establish/distribute session keys
- Session key (data encryption key)
	- used to encrypt messages
	- for one logical session only
### Session Keys
- The more often a symmetric key is used, the more likely it is to be compromised
- Generate symmetric key for one session only - **session key**
	- limits availaable ciphertexts for cryptoanalysis
	- limits exposure in an event of key compromise
- To avoid long-term storage of many session keys, they're only generated when needed

### Session Key Establishment
- Key agreement protocols
	- **Diffie-Hellman protocol** - a shared secret (master or session) isderived by the parties **collaboratively**
- Key transportation protocols
	- without using a PKC
		- **Needham-Schroeder protocol** - Session keys are generated and **distributed using symmetric-key cipher** and with the help of a **third party**
	- using a PKC
		- One party creates a session key and securely transfers it to the other party **using the recipient's public key**

### Session Key Establishment - Issues
- ***Key secrecy and entity/key authentication***
	- No other party should be able to gain access to the established session key
	- The session key is established with the intended entities, i.e. **no impersonation**
	- Key confirmation: the other party should be able to demonstrate knowledge of the key by
		- producing a one-way hash value of the key or
		- encrypting some known data (e.g. nonce) with the key
- Key freshness
## DH protocol
- *Alice* and *Bob* agree on two large integers **g** (generator) and **n** (modulus) **// both public**
- Alice has private key PR<sub>a</sub> and public key PU<sub>a</sub>
- Bob has private key PR<sub>b</sub> and public key PU<sub>b</sub>

1. Alice calculates PU<sub>a</sub> = g<sup>PR<sub>a</sub></sup> mod n
2. Alice sends PU<sub>a</sub> to Bob
3. Bob calculates PU<sub>b</sub> = g<sup>PR<sub>b</sub></sup> mod n
4. Bob sends PU<sub>b</sub> to Alice
5. Both calculate the **symmetric key K<sub>ab</sub>**
	- Alice calculates K<sub>ab</sub> = PU<sub>b</sub><sup>PR<sub>a</sub></sup> mod n (== g<sup>PR<sub>a</sub>PR<sub>b</sub></sup> mod n)
	- Bob calculates K<sub>ab</sub> = PU<sub>a</sub><sup>PR<sub>b</sub></sup> mod n (== g<sup>PR<sub>a</sub>PR<sub>b</sub></sup> mod n)

**DH protocol is vulnerable to man-in-the-middle attack**

![d1e4544d3d719e95f92423c327d71be6.png](../_resources/20cc353188cd408b83ff591bdbe76614.png)

# Symmetric key distribution using symmetric key encryption
## Approach One
![f3125fd966b39f3aae6ec5874435bfe9.png](../_resources/2855b69f6c1940c5861fd6dab2894261.png)
- Lots of keys
- For n users n(n-1)/2 keys
- the n<sup>2</sup> problem
## Needham-Schroeder Protocol
- It uses a Trusted third party (Key distribution centre (KDC))
- both parties A and B share a secret with KDC, K<sub>a</sub> and K<sub>b</sub>
- A and B wish to establish a secure communication channel, i.e. establish a one-time session key K<sub>ab</sub>
- N<sub>a</sub>, N<sub>b</sub> are nonces (random challenges) generated by A and B to keey messages **fresh**

![9120b8da02374e5176279c4400a01d94.png](../_resources/71fce10011a9467daebcbf3349aba6eb.png)

# Symmetric key distribution using PKC (X.509)
## Distribution using PKC - Two passes
![d6668bb39468f967defadde91a550069.png](../_resources/926c7a3fd4c743629c644222cfd98d60.png)
- Secret key distribution with mutual authentication
- C<sub>A</sub> - Certificate of A = PU<sub>A</sub> + CA signature
- {X}S<sub>A</sub> = X||E(PR<sub>A</sub>, H(X))- signed by A
- TS - timestamp
	- ***NOTE***: A's and B's **clocks** have to be **synchronised** and **tamper-proof**
1. Alice sends Bob message 1.
2. Bob uses the public key from C<sub>A</sub> to verify the signature. (if the certificate is not signed by a trusted CA, or is revoked this step fails)
3. Bob sends back a similar message + a symmetric key K<sub>AB</sub> that Bob generates, encrypted with A's public key
4. A verifies B's certificate

## Distribution using PKC - Three passes
- When synchronisation of the clocks is not possible use a 3 pass protocol
- uses r<sub>a</sub> and r<sub>b</sub> which are nonces instead of timestamps
![91c4e692f5500a160a85467d952a9234.png](../_resources/7d52aa69d8984cf38a0a4b89245e4fcd.png)

# Comparison of secret key establishment protocols
![f573132b30b4ca73bd54220f46d1a48a.png](../_resources/aced20d09c654db8b309246f12268000.png)

- Diffie-Hellman has no Entity Authentication. Impersonation attacks are possible (MitM)
- Needham-Schroeder authenticate by demonstrating knowledge of the symmetric key that was generated by KDC
- X.509 (2 pass)